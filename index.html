<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C√¥ng c·ª• AI ƒë√°nh gi√° m·∫≠t kh·∫©u</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js" integrity="sha512-+b0p2c1r4p6X2YQx6n6ZfQp0i8u3wG1uQpX9K8wq2lGm8e1wKf4H2y9Yc9m0Jc7Z2b1L3d4e5f6g7h8i9j0k==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="main.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

</head>
<body>
  <section class="hero">
  <div class="hero-headline">
    <h1>C√¥ng c·ª• ki·ªÉm tra m·∫≠t kh·∫©u s·ª≠ d·ª•ng AI</h1>
    <p class="subtitle">
      C√¥ng c·ª• AI ki·ªÉm tra v√† ƒë√°nh gi√° m·ª©c ƒë·ªô m·∫°nh c·ªßa m·∫≠t kh·∫©u. C√≥ th·ªÉ g·ª£i √Ω t·∫°o m·∫≠t kh·∫©u m·∫°nh.
      <strong class="danger">Tuy·ªát ƒë·ªëi kh√¥ng ƒë∆∞a m·∫≠t kh·∫©u th·∫≠t c·ªßa b·∫°n.</strong>
    </p>
  </div>

  <form id="quickCheck" class="pw-form" onsubmit="return false;">
    <label for="pw" class="pw-label">H√£y nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ ki·ªÉm tra ƒë√°nh gi√°</label>

    <div class="pw-input">
      <input type="password" id="pw" placeholder="Nh·∫≠p m·∫≠t kh·∫©u demo..." autocomplete="off" />
      <button type="button" class="icon-btn" id="togglePw" aria-label="Hi·ªán/·∫©n m·∫≠t kh·∫©u" title="Hi·ªán/·∫©n m·∫≠t kh·∫©u">
        üëÅÔ∏è
      </button>
      <button type="button" class="icon-btn" id="pastePw" aria-label="D√°n t·ª´ clipboard" title="D√°n t·ª´ clipboard">
        üìã
      </button>
    </div>

    <div class="pw-actions">
      <button type="button" id="checkBtn" class="btn btn-primary">Ki·ªÉm tra m·∫≠t kh·∫©u</button>
      <button type="button" id="genBtn" class="btn btn-ghost">T·∫°o m·∫≠t kh·∫©u kh√≥</button>
    </div>

    <div class="pw-hint">
      M·∫πo: kh√¥ng d√πng m·∫≠t kh·∫©u th·∫≠t; th·ª≠ chu·ªói nh∆∞ <code>abcabc123</code>, <code>Qwerty!23</code>, <code>Tr0ng!@2025</code>‚Ä¶
    </div>
  </form>
</section>    
<div id="result" style="margin-top:14px;display:none">
     <!-- DASHBOARD: m·ªói thu·ªôc t√≠nh = 1 √¥ (card) -->
    <div id="metrics" class="metrics-grid" style="display:none;"></div>
</div>
<script>
  //Render Metrics
  function renderMetrics(d){
  const wrap = document.getElementById("metrics");
  wrap.style.display = "grid";
  wrap.innerHTML = ""; // clear c≈©

  const add = (title, value, subHtml="") => {
    const card = document.createElement("div");
    card.className = "metric-card";
    card.innerHTML = `
      <div class="metric-title">${title}</div>
      <div class="metric-value">${value}</div>
      ${subHtml ? `<div class="metric-sub">${subHtml}</div>` : ""}
    `;
    wrap.appendChild(card);
  };

// 1) ƒêi·ªÉm
add("ƒêi·ªÉm (0‚Äì4)",
  `<span class="metric-value"><span class="score-dot score-${d.score}"></span>${d.score}</span>`,
  ["R·∫•t y·∫øu","Y·∫øu","V·ª´a","M·∫°nh","R·∫•t m·∫°nh"][d.score] || "-"
);


  // 2) S·ªë l·∫ßn ƒëo√°n
  add("S·ªë l·∫ßn ƒëo√°n ∆∞·ªõc t√≠nh", formatLarge(d.guesses || 0));

  // 3) R√≤ r·ªâ (HIBP)
  let pwnedVal = "";
  if (d.pwned === null) {
    pwnedVal = `<span class="muted">Kh√¥ng tra ƒë∆∞·ª£c</span>`;
  } else if (d.pwned) {
    pwnedVal = `<span class="pwn-badge pwn-danger">ƒê√É R√í R·ªà</span>`;
  } else {
    pwnedVal = `<span class="pwn-badge pwn-ok">CH∆ØA R√í R·ªà</span>`;
  }
let pwnedSub = (d.pwned && d.pwned_count)
  ? `S·ªë l·∫ßn xu·∫•t hi·ªán: ${formatLarge(d.pwned_count)}`
  : "Kh√¥ng t√¨m th·∫•y trong HIBP";
add("T√¨nh tr·∫°ng r√≤ r·ªâ (HIBP)", pwnedVal, pwnedSub);


  // 4) M·ª©c r·ªßi ro AI
  add("M·ª©c r·ªßi ro (AI)", d.risk_level || "Kh√¥ng x√°c ƒë·ªãnh");

  // 5) Ki·ªÉu t·∫•n c√¥ng c√≥ th·ªÉ
  add("Ki·ªÉu t·∫•n c√¥ng", d.attack_vector || "Kh√¥ng x√°c ƒë·ªãnh");

  // 6) Th·ªùi gian d√≤ 
  add("Th·ªùi gian gi·∫£i m√£",
      `<div><strong>B·ªô x·ª≠ l√Ω c·ªßa ƒëi·ªán tho·∫°i</strong>: ${d.crack_time?.mobile || "‚Äî"}</div>
       <div><strong>GPU M√°y T√≠nh</strong>: ${d.crack_time?.desktop || "‚Äî"}</div>
       <div><strong>C√¥ng ngh·ªá ƒë√°m m√¢y t·ªëi t√¢n</strong>: ${d.crack_time?.cloud || "‚Äî"}</div>`);

  // 7) Th·ªùi gian d√≤ (gi√¢y, s·ªë th√¥ ‚Äì cho ph√¢n t√≠ch)
//B·ªè qua m·ª•c n√†y ƒë·ªÉ giao di·ªán g·ªçn h∆°n
  // 8) G·ª£i √Ω
const escapeHTML = (str) =>
    String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;");

  const hasSug = Array.isArray(d.suggestions) && d.suggestions.length > 0;
  const sugHtml = hasSug
      ? d.suggestions.map(s => `‚Ä¢ ${escapeHTML(s)}`).join("<br>")
      : "Kh√¥ng c√≥ g·ª£i √Ω th√™m.";
  const warnHtml = d.warning ? `<br><i>${escapeHTML(d.warning)}</i>` : "";

  add("G·ª£i √Ω c·∫£i thi·ªán", sugHtml + warnHtml);

}

// helpers
async function sha1Hex(input) {
  const enc = new TextEncoder();
  const data = enc.encode(input);
  const hashBuffer = await crypto.subtle.digest('SHA-1', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2,'0')).join('').toUpperCase();
}

function formatLarge(n){
  if(n===Infinity) return '‚àû';
  if(n<1000) return n.toFixed(0);
  const units=['','K','M','B','T']; let u=0; while(n>=1000 && u<units.length-1){n/=1000;u++;}
  return n.toFixed(2)+units[u];
}

function formatTime(seconds){
  if(seconds===Infinity) return '‚àû';
  const year = 60*60*24*365;
  if(seconds>=year) return (seconds/year).toFixed(2)+' years';
  if(seconds>=86400) return (seconds/86400).toFixed(2)+' days';
  if(seconds>=3600) return (seconds/3600).toFixed(2)+' hours';
  if(seconds>=60) return (seconds/60).toFixed(2)+' minutes';
  return seconds.toFixed(2)+' seconds';
}



function estimateCrackTime(guesses, gps){
  if(!isFinite(guesses) || guesses<=0) return Infinity;
  return guesses / gps;
}

// main
const pwInput = document.getElementById('pw');
const checkBtn = document.getElementById('checkBtn');
const genBtn = document.getElementById('genBtn');
const resultDiv = document.getElementById('result');

checkBtn.onclick = async () => {
  const pw = pwInput.value || "";
  if (!pw) {
    alert("Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ ki·ªÉm tra (ƒë·ª´ng d√πng m·∫≠t kh·∫©u ƒëang s·ª≠ d·ª•ng!)");
    return;
  }

  try {
    const resp = await fetch("http://127.0.0.1:8000/api/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ password: pw }),
    });

    const data = await resp.json();
    console.log(data);

    resultDiv.style.display = "block";
// D·ªØ li·ªáu t·ª´ API
    const scoreValue = data.score;
    const scoreRemain = 4 - scoreValue;
    const secs = data.crack_time_seconds;
    renderMetrics(data);
  } catch (e) {
    console.error(e);
    alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi backend! H√£y ki·ªÉm tra FastAPI server c√≥ ch·∫°y ch∆∞a?");
  }
};


// simple passphrase generator (tiny diceware-like list)
const smallWordlist = ['correct','horse','battery','staple','sunset','river','mountain','coffee','tiger','apple','orange','river','cloud','spark','bottle','garden','silver','oak','stone','paper','keyboard','random','mango','planet','circle','thread','anchor','forest','window','lamp'];

genBtn.onclick = ()=>{
  const parts = [];
  for(let i=0;i<4;i++) parts.push(smallWordlist[Math.floor(Math.random()*smallWordlist.length)]);
  const pass = parts.join('-');
  pwInput.value = pass;
  checkBtn.click();
}

// Wordlist batch processing (client-side; small lists only)
const checkListBtn = document.getElementById('checkListBtn');
checkListBtn.onclick = async ()=>{
  const raw = document.getElementById('wordlist').value.trim();
  if(!raw){alert('Paste some passwords (small lists).');return}
  const lines = raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  const outDiv = document.getElementById('wordlistResult');
  outDiv.innerHTML = '<p class="muted">Processing '+lines.length+' items (client-side). Please wait...</p>';
  const rows = [];
  for(const pw of lines){
    const z = zxcvbn(pw);
    rows.push({ pw, score: z.score, guesses: z.guesses || 0, pwned: "-" });
  }
  // render table
  let html = '<table style="width:100%;border-collapse:collapse">';
  html += '<tr><th>Password</th><th>Score</th><th>Guesses(est)</th><th>Pwned</th></tr>';
  for(const r of rows){
    html += `<tr><td><code>${escapeHtml(r.pw)}</code></td><td>${r.score}</td><td>${formatLarge(r.guesses)}</td><td>${r.pwned}</td></tr>`;
  }
  html += '</table>';
  outDiv.innerHTML = html;
}

function escapeHtml(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

</script>
</body>
</html>